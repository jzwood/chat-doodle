"use strict";function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function setup(){Container=PIXI.Container,autoDetectRenderer=PIXI.autoDetectRenderer,stage=new Container,renderer=autoDetectRenderer(800,600,{antialiasing:!1,transparent:!1,backgroundColor:1087931,resolution:1}),document.body.appendChild(renderer.view),local={clubHouse:newClubHouse()},draw()}function draw(){requestAnimationFrame(draw),local.clubHouse.update(),renderer.render(stage)}function mod(e,n){for(var o=e%n;o<0;)o+=n;return o}function keyboard(e){var n={};return n.code=e,n.isDown=!1,n.isUp=!0,n.press=void 0,n.release=void 0,n.downHandler=function(e){e.keyCode===n.code&&(n.isUp&&n.press&&n.press(),n.isDown=!0,n.isUp=!1),e.preventDefault()},n.upHandler=function(e){e.keyCode===n.code&&(n.isDown&&n.release&&n.release(),n.isDown=!1,n.isUp=!0),e.preventDefault()},window.addEventListener("keydown",n.downHandler.bind(n),!1),window.addEventListener("keyup",n.upHandler.bind(n),!1),n}function newClubHouse(){var e=new Map;return{update:function(){var n,o,t,r;r=e.values(),n=GET_ITER$0(r),t=0===n,o=t?r.length:void 0;for(var i;t?n<o:!(o=n.next()).done;)i=t?r[n++]:o.value,i.update();n=o=t=r=void 0},getMap:function(){return e}}}function newClubMember(e){var n=arguments[1];void 0===n&&(n=!1);var o={},t=0,r=0,i=0,a=0,d=0,u=2,s=50,l=n?40544:16752286,c=new PIXI.Graphics;(function(){c.beginFill(l),c.lineStyle(4,13421772,1),c.moveTo(0,s),c.lineTo(s,s),c.lineTo(s,0),c.lineTo(0,0),c.lineTo(0,s),c.endFill(),stage.addChild(c),o.graphics=c})();if(n){var p=keyboard(37),v=keyboard(38),f=keyboard(39),b=keyboard(40),g=function(e,n){d=1,n?t+=e:r+=e};p.press=function(){g(-u,!0)},f.press=function(){g(u,!0)},v.press=function(){g(-u,!1)},b.press=function(){g(u,!1)}}return o.update=function(){c.x=t,c.y=r},o.getProps=function(){return{x:t,y:r,vx:i,vy:a}},o.setProps=function(e){t=e.x,r=e.y,i=e.vx,a=e.vy},o}function initMember(e,n){var o=socket.id===e,t=newClubMember(e,o);t.setProps(n),local.clubHouse.getMap().set(e,t)}function updateMember(e,n){var o=local.clubHouse.getMap().get(e);o.setProps(n)}function pingServer(e){pingServer=Function("");window.setInterval(function(){local.clubHouse.getMap().get(socket.id)&&socket.emit("updateUser",local.clubHouse.getMap().get(socket.id).getProps())},100)}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,PIXI=void 0,Container=void 0,autoDetectRenderer=void 0,stage=void 0,renderer=void 0,loader=void 0,local=void 0;document.addEventListener("DOMContentLoaded",function(e){console.log("DOM fully loaded and parsed"),setup()});var io,socket=function(){var e=location.href.indexOf("/private");return io(e>0?"/private":"/public")}();socket.emit("init",window.location.pathname.slice(-40)),socket.on("sync",function(e){var n,o,t,r=Object.keys(e);n=GET_ITER$0(r),t=0===n,o=t?r.length:void 0;for(var i;t?n<o:!(o=n.next()).done;)i=t?r[n++]:o.value,local.clubHouse.getMap().has(i)?updateMember(i,e[i]):initMember(i,e[i]);n=o=t=void 0}),socket.on("removeUser",function(e){console.log("deleted",e,"from client map");var n=local.clubHouse.getMap();n.has(e)?(stage.removeChild(n.get(e).graphics),n.delete(e)):console.log("Deleting non-existent user:",e)}),function(e){pingServer()}();
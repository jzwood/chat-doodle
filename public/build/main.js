"use strict";function GET_ITER$0(t){if(t){if(Array.isArray(t))return 0;var e;if(S_MARK$0&&S_MARK$0(t),"object"==typeof t&&"function"==typeof(e=t[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),e.call(t);if(S_MARK$0&&S_MARK$0(void 0),t+""=="[object Generator]")return t}throw new Error(t+" is not iterable")}function setup(){canvasWidth=640,canvasHeight=480;createCanvas(canvasWidth,canvasHeight).parent("sketch-container");frameRate(10),local={fleet:new Map,isUp:!1}}function draw(){var t,e,o,n;background("#ECEEFB"),n=local.fleet.values(),t=GET_ITER$0(n),o=0===t,e=o?n.length:void 0;for(var i;o?t<e:!(e=t.next()).done;)i=o?n[t++]:e.value,i.update();t=e=o=n=void 0}function mod(t,e){for(var o=t%e;o<0;)o+=e;return o}function initShip(t,e){var o=socket.id===t?"#009E60":"#FF9E9E",n=newShip(t,o);n.setProps(e),local.fleet.set(t,n)}function updateShip(t,e){var o=local.fleet.get(t);o.setProps(e)}function newShip(t,e){var o={},n=0,i=0,a=2,c=0,r=15,l=function(){fill(e);var t=3*Math.PI/4;quad(n+.75*r*Math.cos(c),i+.75*r*Math.sin(c),n+r*Math.cos(c-t),i+r*Math.sin(c-t),n-.5*r*Math.cos(c),i-.5*r*Math.sin(c),n+r*Math.cos(c+t),i+r*Math.sin(c+t))};return o.rotate=function(t){var e=arguments[1];void 0===e&&(e=!1),e&&(t*=Math.PI/180),c+=t},o.getProps=function(){return{x:n,y:i,r:c}},o.setProps=function(t){n=t.x,i=t.y,c=t.r},o.update=function(){n=mod(n+a*Math.cos(c),canvasWidth),i=mod(i+a*Math.sin(c),canvasHeight),l()},o}function initSocketListener(t){local.me=socket.id,console.log("initSocketListener"),initSocketListener=Function(""),socket.on(t.disconnect,function(t){console.log("deleted",t,"from client map"),local.fleet.delete(t)});window.setInterval(function(){socket.emit(t.update,local.fleet.get(socket.id).getProps())},100)}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,canvasWidth=void 0,canvasHeight=void 0,createCanvas=void 0,background=void 0,frameRate=void 0,fill=void 0,quad=void 0,local=void 0;document.addEventListener("keyup",function(t){local.isUp=!0},!1),document.addEventListener("keydown",function(t){if(local.isUp){local.isUp=!1;var e=t.key;"ArrowLeft"===e?local.fleet.get(local.me).rotate(-10,!0):"ArrowRight"===e&&local.fleet.get(local.me).rotate(10,!0)}},!1);var io,socket=function(){var t=location.href.indexOf("/private");return io(t>0?"/private":"/public")}();socket.emit("init",window.location.pathname),socket.on("sync",function(t){var e,o,n,i=t.map,a=Object.keys(i);e=GET_ITER$0(a),n=0===e,o=n?a.length:void 0;for(var c;n?e<o:!(o=e.next()).done;)c=n?a[e++]:o.value,local.fleet.has(c)?updateShip(c,i[c]):initShip(c,i[c]);e=o=n=void 0,initSocketListener(t.ids)});
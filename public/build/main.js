"use strict";function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function setup(){var e=800,n=600;Container=PIXI.Container,autoDetectRenderer=PIXI.autoDetectRenderer,stage=new Container,renderer=autoDetectRenderer(e,n,{antialiasing:!1,transparent:!1,backgroundColor:1087931,resolution:1}),document.body.appendChild(renderer.view),local={canvasWidth:e,canvasHeight:n,clubHouse:newClubHouse()},draw()}function draw(){requestAnimationFrame(draw),local.clubHouse.update(),renderer.render(stage)}function mod(e,n){for(var t=e%n;t<0;)t+=n;return t}function debounce(e,n,t){var o;return function(){var r=this,i=arguments,a=function(){o=null,t||e.apply(r,i)},u=t&&!o;clearTimeout(o),o=setTimeout(a,n),u&&e.apply(r,i)}}function keyboard(e){var n={};return n.code=e,n.isDown=!1,n.isUp=!0,n.press=void 0,n.release=void 0,n.downHandler=function(e){e.keyCode===n.code&&(n.isUp&&n.press&&n.press(),n.isDown=!0,n.isUp=!1),e.preventDefault()},n.upHandler=function(e){e.keyCode===n.code&&(n.isDown&&n.release&&n.release(),n.isDown=!1,n.isUp=!0),e.preventDefault()},window.addEventListener("keydown",n.downHandler.bind(n),!1),window.addEventListener("keyup",n.upHandler.bind(n),!1),n}function newClubHouse(){var e=new Map;return{update:function(){var n,t,o,r;r=e.values(),n=GET_ITER$0(r),o=0===n,t=o?r.length:void 0;for(var i;o?n<t:!(t=n.next()).done;)i=o?r[n++]:t.value,i.isSelf()?i.update(e.values()):i.update();n=t=o=r=void 0},getMap:function(){return e}}}function newClubMember(e){var n=arguments[1];void 0===n&&(n=!1);var t={},o=0,r=0,i=0,a=!0,u=!1,l=2,s=50,d=2,c=-2,f=n?40544:16752286;t.isSelf=function(){return n};var v=new PIXI.Graphics,p=(function(){v.beginFill(f),v.lineStyle(2*d,13421772,1),v.drawRect(0,0,s,s),v.endFill(),stage.addChild(v),t.graphics=v}(),{up:!1,down:!1,left:!1,right:!1,time:0}),b=function(e){o+=e},g=function(){var e,n,t;if(u){var i=s+2*d;e=GET_ITER$0(u),t=0===e,n=t?u.length:void 0;for(var a;t?e<n:!(n=e.next()).done;)if(a=t?u[e++]:n.value,!a.isSelf()){var l=a.getProps();if(Math.abs(l.x-o)<i&&Math.abs(l.y-r)<i)return!0}e=n=t=void 0}return!1},y=function(e){a||(a=!0,i=-e)},w=function(){var e=o,n=r;p.right&&b(l),p.left&&b(-l),p.up&&y(7),i-=.1*c,r+=i;var t=local.canvasWidth-s-d,u=local.canvasHeight-s-d;(function(){o>t?o=t:o<d&&(o=d),r>u?(r=u,a=!1,i=0):r<d&&(r=d)})();g()&&(console.log(Math.abs(o-e),Math.abs(r-n)),o=e,r=n,i=0,a=!1)};if(n){var h=keyboard(37),m=keyboard(38),M=keyboard(39),S=keyboard(40);h.press=function(){p.left=!0},h.release=function(){p.left=!1},M.press=function(){p.right=!0},M.release=function(){p.right=!1},m.press=function(){p.up=!0},m.release=function(){p.up=!1},S.press=function(){p.down=!0},S.release=function(){p.down=!1}}return t.update=function(){var e=arguments[0];void 0===e&&(e=!1),u=e;var t,i,a=o-v.x,l=r-v.y;n?(w(),t=i=.8):(t=.1,i=.3),v.x+=a*t,v.y+=l*i},t.getProps=function(){return{x:o,y:r}},t.setProps=function(e){o=e.x,r=e.y},t}function initMember(e,n){var t=socket.id===e,o=newClubMember(e,t);o.setProps(n),local.clubHouse.getMap().set(e,o)}function updateMember(e,n){var t=local.clubHouse.getMap().get(e);t.setProps(n)}function pingServer(e){pingServer=Function("");window.setInterval(function(){local.clubHouse.getMap().get(socket.id)&&socket.emit("updateUser",local.clubHouse.getMap().get(socket.id).getProps())},100)}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,PIXI=void 0,Container=void 0,autoDetectRenderer=void 0,stage=void 0,renderer=void 0,loader=void 0,local=void 0;document.addEventListener("DOMContentLoaded",function(e){console.log("DOM fully loaded and parsed"),setup()});var io,socket=function(){var e=location.href.indexOf("/private");return io(e>0?"/private":"/public")}();socket.emit("init",window.location.pathname.slice(-40)),socket.on("sync",function(e){var n,t,o,r=Object.keys(e);n=GET_ITER$0(r),o=0===n,t=o?r.length:void 0;for(var i;o?n<t:!(t=n.next()).done;)i=o?r[n++]:t.value,local.clubHouse.getMap().has(i)?updateMember(i,e[i]):initMember(i,e[i]);n=t=o=void 0}),socket.on("removeUser",function(e){console.log("deleted",e,"from client map");var n=local.clubHouse.getMap();n.has(e)?(stage.removeChild(n.get(e).graphics),n.delete(e)):console.log("Deleting non-existent user:",e)}),function(e){pingServer()}();
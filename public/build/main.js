"use strict";function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function setup(){var e=800,n=600;Container=PIXI.Container,autoDetectRenderer=PIXI.autoDetectRenderer,stage=new Container,renderer=autoDetectRenderer(e,n,{antialiasing:!1,transparent:!1,backgroundColor:1087931,resolution:1}),document.querySelector(".wrapper__canvas").appendChild(renderer.view),local={canvasWidth:e,canvasHeight:n,clubHouse:newClubHouse(),dividerLine:drawZones(e,n)},MainLoop.setMaxAllowedFPS(60).setUpdate(update).setDraw(draw).start()}function update(e){local.clubHouse.update(e)}function draw(e){renderer.render(stage)}function mod(e,n){for(var t=e%n;t<0;)t+=n;return t}function declareWeak(e){return"undefined"==typeof e?void 0:e}function declareWeakArray(e){for(var n=0,t=e.length;n<t;n++){var o=window[e[n]];o="undefined"==typeof o?void 0:o}}function debounce(e,n,t){var o;return function(){var r=this,i=arguments,a=function(){o=null,t||e.apply(r,i)},d=t&&!o;clearTimeout(o),o=setTimeout(a,n),d&&e.apply(r,i)}}function keyboard(e){var n={};return n.code=e,n.isDown=!1,n.isUp=!0,n.press=void 0,n.release=void 0,n.downHandler=function(e){e.keyCode===n.code&&(n.isUp&&n.press&&n.press(),n.isDown=!0,n.isUp=!1),e.preventDefault()},n.upHandler=function(e){e.keyCode===n.code&&(n.isDown&&n.release&&n.release(),n.isDown=!1,n.isUp=!0),e.preventDefault()},window.addEventListener("keydown",n.downHandler.bind(n),!1),window.addEventListener("keyup",n.upHandler.bind(n),!1),n}function newClubHouse(){var e=new Map;return{update:function(){var n,t,o,r;r=e.values(),n=GET_ITER$0(r),o=0===n,t=o?r.length:void 0;for(var i;o?n<t:!(t=n.next()).done;)i=o?r[n++]:t.value,i.isSelf()?i.update(e.values()):i.update();n=t=o=r=void 0},getMap:function(){return e}}}function newClubMember(e){var n=arguments[1];void 0===n&&(n=!1);var t={},o=0,r=0,i=0,a=!0,d=!1,l=!1,u=!1,c=2,s=70,f=2,v=-2,p=.1*v,g=local.dividerLine-s/2,w=n?40544:16752286;t.isSelf=function(){return n};var b=new PIXI.Graphics,h=(function(){b.beginFill(w),b.lineStyle(2*f,13421772,1),b.drawRect(0,0,s,s),b.endFill(),stage.addChild(b),t.graphics=b}(),{up:!1,down:!1,left:!1,right:!1,time:0}),y=function(e){o+=e},M=function(e){u=n&&r<g},m=function(e){var n,t,i;if(l){var a=.01,d=s+2*f-a;n=GET_ITER$0(l),i=0===n,t=i?l.length:void 0;for(var u;i?n<t:!(t=n.next()).done;)if(u=i?l[n++]:t.value,!u.isSelf()){var c=u.getProps();Math.abs(c.x-o)<d&&Math.abs(c.y-r)<d&&(e(c.x,c.y),console.log("col"))}n=t=i=void 0}},S=function(e){a||(a=!0,i-=e)},I=function(){var e=(function(){h.right&&y(c),h.left&&y(-c),h.up&&S(7)}(),function(){i+=u?p:-p,r+=i,d=!1}(),local.canvasWidth-s-f),n=local.canvasHeight-s-f;m(function(e,n){var t=Math.abs(e-o),l=Math.abs(n-r);l>t?r-n<0?(r+=p,Math.abs(t-l)>.8&&(a=!1),i=Math.min(i,0)):(d=!0,r-=p,i=Math.max(i,0)):o+=o-e<0?-c:c});(function(){o>e?o=e:o<f&&(o=f),r>n?(r=n,i=0,a=!!d):r<f&&(r=f)})()};if(n){var k=keyboard(37),R=keyboard(38),x=keyboard(39),C=keyboard(40);k.press=function(){h.left=!0},k.release=function(){h.left=!1},x.press=function(){h.right=!0},x.release=function(){h.right=!1},R.press=function(){h.up=!0},R.release=function(){h.up=!1},C.press=function(){h.down=!0},C.release=function(){h.down=!1}}return t.update=function(){var e=arguments[0];void 0===e&&(e=!1),M(),l=e;var t,i,a=o-b.x,d=r-b.y;n?(I(),t=i=.8):(t=.1,i=.3),b.x+=a*t,b.y+=d*i},t.getProps=function(){return{x:o,y:r}},t.setProps=function(e){o=e.x,r=e.y},t}function initMember(e,n){var t=newClubMember(e,isMyId(e));n.x!==-1&&n.y!==-1?t.setProps(n):t.setProps({x:local.canvasWidth/2,y:local.canvasHeight/2}),local.clubHouse.getMap().set(e,t)}function updateMember(e,n){if(!isMyId(e)){var t=local.clubHouse.getMap().get(e);t.setProps(n)}}function drawZones(e,n){var t=new PIXI.Graphics,o=n/4;t.beginFill(1245093),t.drawRect(0,0,e,o),t.endFill(),stage.addChild(t);var r={fontFamily:"Arial",fontSize:"50px",fontWeight:"bold",fill:"#F7EDCA"},i=new PIXI.Text("WINNER",r);i.x=e/2-i.width/2,i.y=o-1.5*i.height,stage.addChild(i);var a=new PIXI.Graphics;a.lineStyle(4,16777215,1),a.moveTo(0,o);for(var d=20,l=e/d,u=l;u<=e;u+=l)a.lineTo(u-l/2,o),a.moveTo(u,o);stage.addChild(a);var c=new PIXI.Text("LOSER",r);return c.x=e/2-c.width/2,c.y=o+.5*c.height,stage.addChild(c),o}function pingServer(e){pingServer=Function("");window.setInterval(function(){if(local){var e=local.clubHouse.getMap().get(socket.id);e&&socket.emit("updateUser",e.getProps())}},100)}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,PIXI=void 0,Container=void 0,autoDetectRenderer=void 0,stage=void 0,renderer=void 0,loader=void 0,MainLoop=declareWeak(window.MainLoop),local=void 0;document.addEventListener("DOMContentLoaded",function(e){console.log("DOM fully loaded and parsed"),setup()});var isMyId=function(e){return e===socket.id},io,socket=function(){var e=location.href.indexOf("/private");return io(e>0?"/private":"/public")}();socket.emit("init",window.location.pathname.slice(-40)),socket.on("sync",function(e){var n,t,o,r=Object.keys(e);n=GET_ITER$0(r),o=0===n,t=o?r.length:void 0;for(var i;o?n<t:!(t=n.next()).done;)i=o?r[n++]:t.value,local&&(local.clubHouse.getMap().has(i)?updateMember(i,e[i]):initMember(i,e[i]));n=t=o=void 0}),socket.on("removeUser",function(e){console.log("deleted",e,"from client map");var n=local.clubHouse.getMap();n.has(e)?(stage.removeChild(n.get(e).graphics),n.delete(e)):console.log("Deleting non-existent user:",e)}),function(e){pingServer()}();
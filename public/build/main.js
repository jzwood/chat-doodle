function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function newClubHouse(e){var n=new Map;return{update:function(){var e,o,t,r;r=n.values(),e=GET_ITER$0(r),t=0===e,o=t?r.length:void 0;for(var a;t?e<o:!(o=e.next()).done;)a=t?r[e++]:o.value,a.update();e=o=t=r=void 0},updateMemberInformation:function(e,o){n.get(e).setProps(o)},getMap:function(){return n},initMember:function(o,t){var r=newClubMember(o,e);r.setProps(t),n.set(o,r)}}}function newClubMember(e,n){var o=0,t=!1,r={up:!1,down:!1,left:!1,right:!1};isMyId(e)&&(t=!0,assignKeys(r));return{isSelf:function(){return t},update:function(){console.log("do update step here")},getProps:function(){return o},setProps:function(e){o=e}}}function setup(){for(var e=645,n=15;e%n!==0;)n++;console.log("gridSize",n);var o=createCanvas(640,640);o.parent("wrapper__canvas"),o.class("wrapper__canvas__p5"),console.log("waiting for network connection");var t=window.setInterval(function(){console.count("attempts"),io&&(console.log("network connected"),start(e,n),clearInterval(t))},100)}function start(e,n){var o=location.href.indexOf("/private"),t=io(o>0?"/private":"/public");local={canvasWidth:e,canvasHeight:e,environment:newEnvironment(n),sock:t,clubHouse:newClubHouse()},connectToServer(t),MainLoop.setMaxAllowedFPS(60).setUpdate(update).setDraw(paint).setEnd(end).start()}function update(e){local.clubHouse.update(e),local.environment.updateGraphics(e)}function paint(e){}function draw(){}function newEnvironment(e){var n=[],o=e*e;n.length=o,n.fill(1);var t={"-1":16711680,0:16777215,1:0,2:12770037,3:14417890};return{size:e,getSquare:function(o,t){var r=o+e*t;return acceptableIndex(r)?n[o+e*t]:(console.warn("Index",r,"out of range. getSquare(",o,t,") failed."),-1)},setSquare:function(o,t,r){var a=o+e*t;acceptableIndex(a)?n[a]=r:console.warn("Index",a,"out of range. setSquare(",o,t,r,") failed.")},updateGraphics:function(){window.background("#cccccc"),window.noStroke();for(var r=.25,a=0;a<o;a++){window.fill(t[n[a]]);var i=local.canvasWidth/e,c=local.canvasHeight/e;window.rect(i*(a%e),c*~~(a/e),c-r,i-r)}}}}function mod(e,n){for(var o=e%n;o<0;)o+=n;return o}function IIFE(e){e()}function acceptableIndex(e,n){return e>=0&&e<n}function isMyId(e){return local.sock.id?e===local.sock.id:(console.warn("local.sock.id not set"),!1)}function end(e,n){if(n){var o=Math.round(MainLoop.resetFrameDelta());console.warn("Main loop panicked, probably because the browser tab was put in the background. Discarding "+o+"ms")}}function assignKeys(e){var n=keyboard(37),o=keyboard(38),t=keyboard(39),r=keyboard(40);n.press=function(){e.left=!0},n.release=function(){e.left=!1},t.press=function(){e.right=!0},t.release=function(){e.right=!1},o.press=function(){e.up=!0},o.release=function(){e.up=!1},r.press=function(){e.down=!0},r.release=function(){e.down=!1}}function declareWeak(e){return"undefined"==typeof e?void 0:e}function declareWeakArray(e){for(var n=0,o=e.length;n<o;n++){var t=window[e[n]];t="undefined"==typeof t?void 0:t}}function debounce(e,n,o){var t;return function(){var r=this,a=arguments,i=function(){t=null,o||e.apply(r,a)},c=o&&!t;clearTimeout(t),t=setTimeout(i,n),c&&e.apply(r,a)}}function keyboard(e){var n={};return n.code=e,n.isDown=!1,n.isUp=!0,n.press=void 0,n.release=void 0,n.downHandler=function(e){e.keyCode===n.code&&(n.isUp&&n.press&&n.press(),n.isDown=!0,n.isUp=!1),e.preventDefault()},n.upHandler=function(e){e.keyCode===n.code&&(n.isDown&&n.release&&n.release(),n.isDown=!1,n.isUp=!0),e.preventDefault()},window.addEventListener("keydown",n.downHandler.bind(n),!1),window.addEventListener("keyup",n.upHandler.bind(n),!1),n}function connectToServer(e){e.emit("init",window.location.pathname.slice(-40)),e.on("sync",function(e){var n,o,t,r=Object.keys(e),a=local.clubHouse;if(a){n=GET_ITER$0(r),t=0===n,o=t?r.length:void 0;for(var i;t?n<o:!(o=n.next()).done;)i=t?r[n++]:o.value,a.getMap().has(i)?a.updateMemberInformation(i,e[i]):a.initMember(i,e[i]);n=o=t=void 0}else console.error("local.clubHouse not found in socket-client.\nlocal:",local)}),e.on("removeUser",function(e){console.log("deleted",e,"from client map");var n=local.clubHouse.getMap();n.has(e)?n.delete(e):console.log("Deleting non-existent user:",e)})}function pingServer(e,n){var o=local.clubHouse.getMap().get(n.id);o&&n.emit("updateUser",o.getProps())}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,MainLoop=declareWeak(window.MainLoop),background=declareWeak(window.background),createCanvas=declareWeak(window.createCanvas),io=declareWeak(window.io),local=void 0;
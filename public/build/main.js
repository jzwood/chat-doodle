function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function newClubHouse(e){var n=new Map;return{update:function(){var e,o,t,r;r=n.values(),e=GET_ITER$0(r),t=0===e,o=t?r.length:void 0;for(var a;t?e<o:!(o=e.next()).done;)a=t?r[e++]:o.value,a.update();e=o=t=r=void 0},updateMemberInformation:function(e,o){n.get(e).setProps(o)},getMap:function(){return n},initMember:function(o,t){var r=newClubMember(o,e);r.setProps(t),n.set(o,r)}}}function newClubMember(e,n){var o=0,t=!1,r=n*n,a=local.canvasWidth/n,i=local.canvasHeight/n,c={up:!1,down:!1,left:!1,right:!1};isMyId(e)&&(t=!0,assignKeys(c));var u=200,l=throttle(function(e){var t=o%n+e;acceptableIndex(t,n)&&(o+=e)},u),s=throttle(function(e){var t=o+e*n;acceptableIndex(t,r)&&(o=t)},u);return{isSelf:function(){return t},update:function(){c.up?s(-1):c.down&&s(1),c.left?l(-1):c.right&&l(1),c.r&&local.environment.setSquareIndex(o,1),window.stroke("#ff0000"),window.strokeWeight(1);var e=.25;window.noFill(),window.rect(a*(o%n),i*~~(o/n),i-e,a-e)},getProps:function(){return o},setProps:function(e){o=e.index}}}function setup(){for(var e=700,n=25;e%n!==0;)n++;console.log("gridSize",n);var o=createCanvas(640,640);o.parent("wrapper__canvas"),o.class("wrapper__canvas__p5"),console.log("waiting for network connection");var t=window.setInterval(function(){console.count("attempts"),io&&(console.log("network connected"),start(e,n),clearInterval(t))},100)}function start(e,n){var o=location.href.indexOf("/private"),t=io(o>0?"/private":"/public");local={canvasWidth:e,canvasHeight:e,environment:newEnvironment(n),sock:t,clubHouse:newClubHouse(n)},connectToServer(t),MainLoop.setMaxAllowedFPS(60).setUpdate(update).setDraw(paint).setEnd(end).start()}function update(e){local.environment.updateAutomata(e),local.environment.updateGraphics(e)}function paint(e){local.clubHouse.update(e)}function newEnvironment(e){var n=[],o=e*e;n.length=o,n.fill(0);var t=[];t.length=o,t.fill(0);var r={0:"#000000",1:"#C2DAF5",2:"#DBFFE2",3:"#ffffff"};return{size:e,setSquareIndex:function(e,n){acceptableIndex(e,o)?t[e]=n:console.warn("Index",e,"out of range. setSquareIndex(",e,") failed.")},updateGraphics:function(){window.background("#cccccc"),window.noStroke();for(var a=.25,i=0;i<o;i++){n[i]=t[i],window.fill(r[n[i]]);var c=local.canvasWidth/e,u=local.canvasHeight/e;window.rect(c*(i%e),u*~~(i/e),u-a,c-a)}},updateAutomata:function(){for(var r,a,i,c=0;c<o;c++){var u=getIndices(c,e),l=0,s=0,d=0;r=GET_ITER$0(u),i=0===r,a=i?u.length:void 0;for(var f;i?r<a:!(a=r.next()).done;)f=i?u[r++]:a.value,0===f?l++:1===f?s++:2===f&&d++;r=a=i=void 0;var p=s+d;n[c]?p<2?t[c]=0:2===p||3===p?s>d?t[1]=1:s<d&&(t[1]=2):t[c]=0:3===p&&(s>d?t[1]=1:s<d?t[1]=2:console.error("impossible state reached"))}}}}function mod(e,n){for(var o=e%n;o<0;)o+=n;return o}function IIFE(e){e()}function acceptableIndex(e,n){return e>=0&&e<n}function getSquare(e,n,o,t){var r=e,a=r%t+n;if(!acceptableIndex(a,t))return 0;r+=n;var i=r+o*t;return acceptableIndex(i,t*t)?r=i:0}function isMyId(e){return local.sock.id?e===local.sock.id:(console.warn("local.sock.id not set"),!1)}function end(e,n){if(n){var o=Math.round(MainLoop.resetFrameDelta());console.warn("Main loop panicked, probably because the browser tab was put in the background. Discarding "+o+"ms")}}function assignKeys(e){var n=keyboard(37),o=keyboard(38),t=keyboard(39),r=keyboard(40),a=keyboard(82);n.press=function(){e.left=!0},n.release=function(){e.left=!1},t.press=function(){e.right=!0},t.release=function(){e.right=!1},o.press=function(){e.up=!0},o.release=function(){e.up=!1},r.press=function(){e.down=!0},r.release=function(){e.down=!1},a.press=function(){e.r=!0},a.release=function(){e.r=!1}}function declareWeak(e){return"undefined"==typeof e?void 0:e}function declareWeakArray(e){for(var n=0,o=e.length;n<o;n++){var t=window[e[n]];t="undefined"==typeof t?void 0:t}}function throttle(e,n){var o=0;return function(){var t=arguments,r=this,a=+new Date;a>=o+n&&(o=a,e.apply(r,t))}}function debounce(e,n,o){var t;return function(){var r=this,a=arguments,i=function(){t=null,o||e.apply(r,a)},c=o&&!t;clearTimeout(t),t=setTimeout(i,n),c&&e.apply(r,a)}}function keyboard(e){var n={};return n.code=e,n.isDown=!1,n.isUp=!0,n.press=void 0,n.release=void 0,n.downHandler=function(e){e.keyCode===n.code&&(n.isUp&&n.press&&n.press(),n.isDown=!0,n.isUp=!1),e.preventDefault()},n.upHandler=function(e){e.keyCode===n.code&&(n.isDown&&n.release&&n.release(),n.isDown=!1,n.isUp=!0),e.preventDefault()},window.addEventListener("keydown",n.downHandler.bind(n),!1),window.addEventListener("keyup",n.upHandler.bind(n),!1),n}function getIndices(e,n){return[getSquare(e,-1,-1,n),getSquare(e,1,-1,n),getSquare(e,0,-1,n),getSquare(e,-1,0,n),getSquare(e,1,0,n),getSquare(e,-1,1,n),getSquare(e,0,1,n),getSquare(e,1,1,n)]}function connectToServer(e){e.emit("init",window.location.pathname.slice(-40)),e.on("sync",function(e){var n,o,t,r=Object.keys(e),a=local.clubHouse;if(a){n=GET_ITER$0(r),t=0===n,o=t?r.length:void 0;for(var i;t?n<o:!(o=n.next()).done;)i=t?r[n++]:o.value,a.getMap().has(i)?a.updateMemberInformation(i,e[i]):a.initMember(i,e[i]);n=o=t=void 0}else console.error("local.clubHouse not found in socket-client.\nlocal:",local)}),e.on("removeUser",function(e){console.log("deleted",e,"from client map");var n=local.clubHouse.getMap();n.has(e)?n.delete(e):console.log("Deleting non-existent user:",e)})}function pingServer(e,n){var o=local.clubHouse.getMap().get(n.id);o&&n.emit("updateUser",o.getProps())}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,MainLoop=declareWeak(window.MainLoop),background=declareWeak(window.background),createCanvas=declareWeak(window.createCanvas),io=declareWeak(window.io),local=void 0;
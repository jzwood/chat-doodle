"use strict";function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var t;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(t=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),t.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function setup(){canvasWidth=640,canvasHeight=480;createCanvas(canvasWidth,canvasHeight).parent("sketch-container");frameRate(10),local={fleet:new Map,isUp:!1}}function draw(){var e,t,o,n;background("#ffffff"),n=local.fleet.values(),e=GET_ITER$0(n),o=0===e,t=o?n.length:void 0;for(var i;o?e<t:!(t=e.next()).done;)i=o?n[e++]:t.value,i.update();e=t=o=n=void 0}function mod(e,t){for(var o=e%t;o<0;)o+=t;return o}function initShip(e,t){var o=socket.id===e?"#009E60":"#FF9E9E",n=newShip(e,o);n.setProps(t),local.fleet.set(e,n)}function updateShip(e,t){var o=local.fleet.get(e);o.setProps(t)}function newShip(e,t){var o={},n=0,i=0,a=2,r=0,c=15,l=function(){fill(t);var e=3*Math.PI/4;quad(n+.75*c*Math.cos(r),i+.75*c*Math.sin(r),n+c*Math.cos(r-e),i+c*Math.sin(r-e),n-.5*c*Math.cos(r),i-.5*c*Math.sin(r),n+c*Math.cos(r+e),i+c*Math.sin(r+e))};return o.rotate=function(e){var t=arguments[1];void 0===t&&(t=!1),t&&(e*=Math.PI/180),r+=e},o.getProps=function(){return{x:n,y:i,r:r}},o.setProps=function(e){n=e.x,i=e.y,r=e.r},o.update=function(){n=mod(n+a*Math.cos(r),canvasWidth),i=mod(i+a*Math.sin(r),canvasHeight),l()},o}function pingServer(e){pingServer=Function("");window.setInterval(function(){local.fleet.get(socket.id)&&socket.emit("updateUser",local.fleet.get(socket.id).getProps())},100)}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,canvasWidth=void 0,canvasHeight=void 0,createCanvas=void 0,background=void 0,frameRate=void 0,fill=void 0,quad=void 0,local=void 0;document.addEventListener("keyup",function(e){local.isUp=!0},!1),document.addEventListener("keydown",function(e){if(local.isUp){local.isUp=!1;var t=e.key;"ArrowLeft"===t?local.fleet.get(socket.id).rotate(-10,!0):"ArrowRight"===t&&local.fleet.get(socket.id).rotate(10,!0)}},!1);var io,socket=function(){var e=location.href.indexOf("/private");return io(e>0?"/private":"/public")}();socket.emit("init",window.location.pathname.slice(-40)),socket.on("sync",function(e){var t,o,n,i=Object.keys(e);t=GET_ITER$0(i),n=0===t,o=n?i.length:void 0;for(var a;n?t<o:!(o=t.next()).done;)a=n?i[t++]:o.value,local.fleet.has(a)?updateShip(a,e[a]):initShip(a,e[a]);t=o=n=void 0}),socket.on("removeUser",function(e){console.log("deleted",e,"from client map"),local.fleet.delete(e)}),function(e){pingServer()}();